<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayFlow | Admin Vault</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root{--glass:rgba(255,255,255,0.92);--dark:#121212;--accent:#555;--err:#ff4d4d;--success:#00cc66;--input-bg:rgba(255,255,255,0.6);}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
        
        body{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#000;padding:40px 20px;overflow-x:hidden;}
        
        .bg-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(rgba(0,0,0,0.65),rgba(0,0,0,0.65)),url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ad?auto=format&fit=crop&q=80&w=2000');background-size:cover;background-position:center;filter:grayscale(100%);z-index:-1;transition:transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);}
        body:hover .bg-overlay{transform:scale(1.05);}

        .quote-box{text-align:center;margin-bottom:35px;z-index:1;animation:fadeInDown 0.8s ease-out;}
        @keyframes fadeInDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
        .quote-text{color:#fff;font-size:2.5rem;font-weight:900;text-transform:uppercase;text-shadow:0 10px 30px #000;line-height:1.1;}
        .quote-author{color:#ccc;display:block;margin-top:10px;letter-spacing:4px;font-size:1.1rem;font-weight:300;}

        .signup-card{background:var(--glass);backdrop-filter:blur(20px);width:100%;max-width:450px;padding:45px 35px;border-radius:32px;box-shadow:0 30px 60px rgba(0,0,0,0.5);text-align:center;z-index:2;}

        .brand{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:10px;}
        .logo-box{width:42px;height:42px;background:var(--dark);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;}
        .brand h1{font-size:32px;font-weight:900;letter-spacing:-2px;color:var(--dark);}

        .hr-heading{color:var(--dark);font-size:18px;font-weight:800;letter-spacing:1px;text-transform:uppercase;margin-bottom:25px;opacity:0.8;display:flex;align-items:center;justify-content:center;gap:8px;}
        .hr-heading::before, .hr-heading::after{content:"";height:2px;width:20px;background:var(--dark);opacity:0.2;}

        .form-grid{display:flex;flex-direction:column;gap:14px;margin-bottom:20px;}
        input{width:100%;padding:14px 16px;border-radius:12px;border:1px solid rgba(0,0,0,0.1);background:var(--input-bg);outline:none;font-size:14px;transition:0.3s;}
        input:focus{border-color:var(--dark);background:#fff;}

        .btn-action{width:100%;padding:16px;border-radius:14px;background:var(--dark);color:#fff;border:none;font-weight:800;font-size:16px;cursor:pointer;transition:0.3s;}
        .btn-action:hover{background:#000;transform:scale(1.02);}

        #msg{font-size:12px;margin-top:12px;font-weight:700;min-height:18px;}
        
        .vault-list{margin-top:20px; text-align: left; max-height: 200px; overflow-y: auto; padding: 5px;}
        .vault-item{background: rgba(0,0,0,0.05); padding: 10px; border-radius: 10px; margin-bottom: 8px; font-size: 12px; border: 1px solid rgba(0,0,0,0.1);}
        .vault-item b{display: block; font-size: 14px;}
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <div class="quote-box">
        <h2 class="quote-text">“Security is not a product,<br>it is a process.”</h2>
        <span class="quote-author">— BRUCE SCHNEIER</span>
    </div>

    <div class="signup-card">
        <div class="brand">
            <div class="logo-box"><i data-lucide="shield-check" size="24"></i></div>
            <h1>DayFlow</h1>
        </div>

        <h2 class="hr-heading">Admin HR Vault</h2>

        <form id="vaultForm" onsubmit="return false;">
            <div class="form-grid">
                <input type="email" id="hrEmail" placeholder="HR Gmail Address" required>
                <input type="text" id="hrPass" placeholder="Assign Password" required>
            </div>
            <button class="btn-action" onclick="storeInVault()">Authorize HR Access</button>
        </form>

        <p id="msg"></p>

        <div class="vault-list" id="vault-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // IMPORTING AUTH TO CREATE REAL LOGIN SESSIONS
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOtYswAffd96SMW1_ZZ7j_hxpvvNoPd0E",
            authDomain: "dayflow-423ca.firebaseapp.com",
            projectId: "dayflow-423ca",
            storageBucket: "dayflow-423ca.firebasestorage.app",
            messagingSenderId: "450526966118",
            appId: "1:450526966118:web:1ebe2b97bc33aff24358a7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        lucide.createIcons();

        window.storeInVault = async () => {
            const email = document.getElementById('hrEmail').value.trim();
            const pass = document.getElementById('hrPass').value;
            const msg = document.getElementById('msg');

            if(!email || !pass) {
                msg.innerText = "Error: Fill all fields.";
                msg.style.color = "var(--err)";
                return;
            }

            msg.style.color = "var(--dark)";
            msg.innerText = "Synchronizing with Auth System...";

            try {
                // 1. CREATE AUTH USER (Enables real login)
                await createUserWithEmailAndPassword(auth, email, pass);

                // 2. STORE IN FIRESTORE (For your admin view list)
                await addDoc(collection(db, "hr_vault"), {
                    email: email,
                    password: pass,
                    createdAt: new Date()
                });

                msg.style.color = "var(--success)";
                msg.innerText = "Success! HR is now Authorized & Registered.";
                document.getElementById('vaultForm').reset();
                loadVault();
            } catch (e) {
                msg.style.color = "var(--err)";
                if(e.code === 'auth/email-already-in-use') {
                    msg.innerText = "This email is already in the system.";
                } else if(e.code === 'auth/weak-password') {
                    msg.innerText = "Password must be at least 6 characters.";
                } else {
                    msg.innerText = "Error: " + e.message;
                }
            }
        };

        async function loadVault() {
            const list = document.getElementById('vault-list');
            list.innerHTML = "<p style='font-size:11px; color:#888;'>Updating vault...</p>";
            
            try {
                const q = query(collection(db, "hr_vault"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);
                list.innerHTML = "";
                snapshot.forEach(doc => {
                    const data = doc.data();
                    list.innerHTML += `
                        <div class="vault-item">
                            <b>${data.email}</b>
                            Password: ${data.password}
                        </div>
                    `;
                });
            } catch (e) {
                list.innerHTML = "<p style='font-size:11px; color:red;'>Login required to view vault list.</p>";
            }
        }

        loadVault();
    </script>
</body>
</html>